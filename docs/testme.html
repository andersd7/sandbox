<head>
  <title>Zafin Product Configuration Viewer</title>

    <!-- Bootstrap CSS for styling -->
    <!-- jQuery (required for Bootstrap) -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<!-- Bootstrap JS (after jQuery) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- Bootstrap Table and Filter Control JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap-table@1.21.1/dist/bootstrap-table.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap-table@1.21.1/dist/extensions/filter-control/bootstrap-table-filter-control.min.js"></script>


  <!-- Handlebars Library -->
  <script src="https://cdn.jsdelivr.net/npm/handlebars@latest/dist/handlebars.js"></script>

  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://unpkg.com/renderjson@1.3.0/renderjson.js"></script>

  <!-- Bootstrap Table and Filter Control CSS -->
  <link rel="stylesheet" href="https://cdn.rawgit.com/toni-heittola/js-datatable/v1.1.0/css.min/bootstrap-table-filter-control.min.css">

  <!-- Bootstrap CSS for styling -->
  <link rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.18.2/dist/bootstrap-table.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

    </head>
    <body>

  <!-- Product Name Partial -->
  <script id="product-name-template" type="text/x-handlebars-template">
    <div>
      <h2>({{place}}) {{product.productName}} as at {{formatDate asofDate}}</h2>
      <table>
        <tr>
          <th>Code</th>
          <th>Description</th>
          <th>Classification</th>
        </tr>
        <tr>
          <td>{{product.productCode}}</td>
          <td>{{product.productDescription}}</td>
          <td>{{product.productClassification}}</td>
        </tr>
        </table>
    </div>
  </script>

  <!-- Eligibility Partial -->
  <script id="eligibility-template" type="text/x-handlebars-template">
    <table>
      <tr><th colspan="2">Eligibility Parameters</th></tr>
      <tr>
        <td>
        <table>
          <tr><th colspan="2">Life Cycle</th></tr>
          <tr><th>Status</th><td>{{#if productStatus}} {{productStatus}} {{/if}}
            {{#if serviceStatus}} {{serviceStatus}} {{/if}}</td></tr>
          <tr><th>From Date</th><td>{{formatDate this.fromDate}}</td></tr>
          <tr><th>To Date</th><td>{{formatDate this.toDate}}</td></tr>
        </table>
      </td>
      <td>
    {{#with this.eligibilityCriteria}}
    <table>
      <tr><th colspan="2">Eligibility Criteria</th></tr>
      <tr><th>Type</th><th>Criteria</th></tr>
      {{#if this.customerSegment}}
      <tr>
        <td>Customer Segment</td>
        <td>
        {{#each this.customerSegment}}
            <li> {{this.code}}</li>
        {{/each}}
        </td>
      </tr>
      {{/if}}
      {{#if this.customerRelationshipType}}
      <tr>
        <td>Relationship Type</td>
        <td>
        {{#each this.customerRelationshipType}}
            <li> {{this.relationshipName}} ({{this.code}})</li>
        {{/each}}
    </td>
    </tr>
      {{/if}}
      {{#if this.ageGroup}}
      <tr>
        <td>Age Group</td>
        <td>
        {{#each this.ageGroup}}
            <li> {{this.code}} (From = {{this.fromValue}}, To = {{this.toValue}})</li>
        {{/each}}
        </td>
      </tr>
      {{/if}}
      {{#if this.residencyStatus}}
      <tr>
        <td>Residency Status</td>
        <td>
        {{#each this.residencyStatus}}
            <li> {{this.code}}</li>
        {{/each}}
        </td>
      </tr>
      {{/if}}
      {{#if this.naturalPerson}}
      <tr>
        <td>Natural Person</td>
        <td>
        {{#each this.naturalPerson}}
            <li> {{this.code}}</li>
        {{/each}}
        </td>
      </tr>
      {{/if}}
    </table>
    {{/with}}
    </td></tr>
    </table>
  </script>

  <!-- Deposit Product Config Partial -->
  <script id="deposit-product-config-template" type="text/x-handlebars-template">

    {{#with product.productConfiguration}}
    <table>
      <tr>
        <td>
        {{#with productParameters}}
        <table>
          <tr><th colspan="2">Product Parameters</th></tr>
          <tr><th>Brand</th><td>{{brand.name}} ({{brand.code}})</td></tr>
          <tr><th>Fee Cycle</th>
            <td>
            {{#each feeCycle}}
            <li>{{code}}</li>
            {{/each}}
            </td>
          </tr>
          <tr><th>Statement Cycle</th>
            <td>
            {{#each statementCycle}}
            <li>{{code}} (Frequency = {{frequency}})</li>
            {{/each}}
            </td>
          </tr>
          <tr><th>Statement Type</th>
            <td>
            {{#each statementType}}
            <li>{{code}}</li>
            {{/each}}
            </td>
          </tr>
          <tr><th>CR Interest Cycle</th>
            <td>
            {{#each creditInterestCycle}}
            <li>{{code}}</li>
            {{/each}}
          </td>
          </tr>
          <tr><th>DR Interest Cycle</th>
            <td>
            {{#each debitInterestCycle}}
            <li>{{code}}</li>
            {{/each}}
            </td>
          </tr>
          <tr><th>Is Redirect Credit Interest Allowed</th><td>{{reDirectInterest.isRedirectCreditInterestAllowed}}</td></tr>
          <tr><th>Is Redirect Debit Interest Allowed</th><td>{{reDirectInterest.isRedirectDebitInterestAllowed}}</td></tr>
        </table>
        {{/with}}
        </td>
        <td>
          {{#with financialParameters}}
          {{> financial-parameters-template}}
          {{/with}}
          <br>
          {{#with behaviourParameters}}
          <table>
            <tr><th colspan="2">Behaviour Parameters</th></tr>
            <tr>
              <th>Informal Overdraft</th>
              <td>
                <li>Applicable = {{informalOverDraft.inFormalOverdraftApplicable}}</li>
                <li>Tolerance = {{informalOverDraft.inFormalOverdraftTolerance}}</li>
              </td>
            </tr>
            <tr>
              <th>Overdraft Treatment</th>
              <td>{{informalOverDraft.overdrawnTreatment.name}} ({{informalOverDraft.overdrawnTreatment.name}}) {{informalOverDraft.overdrawnTreatment.description}}</td>
          </tr>
          </table>
          {{/with}}
          <br>
          {{#with entitlementParameters}}
          {{> entitlements-template}}
          {{/with}}
        </td>
        <td>
          {{#with regulatoryParameters}}
          {{> regulatory-parameters-template}}
          {{/with}}

          <br>  
          {{#with documentations}}
          {{> documentation-template}}
          {{/with}}          
        </td>
      </tr>
    </table>
    {{/with}}

  </script>

  <!-- Term Deposit Product Config Partial -->
  <script id="term-deposit-product-config-template" type="text/x-handlebars-template">
    <table>
    <tr>
      <td>
    {{#with product.termDepositProductConfiguration}}
        {{#with productParameters}}
        <table>
          <tr><th colspan="2">Product Parameters</th></tr>
          <tr><th>Brand</th><td>{{brand.name}} ({{brand.code}})</td></tr>
          <tr><th>Short Name</th><td>{{shortName}}</td></tr>
          <tr><th>Short Description</th><td>{{shortDescription}}</td></tr>
          <tr><th>Interest Payment Frequency</th>
            <td>
              {{#each interestPaymentFrequency}}
              <li>{{name}} ({{code}})</li>
              {{/each}}
            </td>
          </tr>
        </table>
        {{/with}}
      <br>
        {{#with financialParameters}}
        {{> financial-parameters-template}}
        {{/with}}
      <br>
        {{#with entitlementParameters}}
        {{> entitlements-template}}
        {{/with}}
      </td>  
        <td>
          <table>
          <tr><th colspan="2">Investment Parameters</th></tr>
          {{#with productParameters.investmentParameters}}
          <tr><th>Min Investment Amount</th><td>{{minimumInvestmentAmount}}</td></tr>
          <tr><th>Max Investment Amount</th><td>{{maximumInvestmentAmount}}</td></tr>
          <tr><th>Min Withdrawal Amount</th><td>{{minimumWithdrawalAmount}}</td></tr>
          <tr><th>Penalty Interest</th>
            <td>
              <table>
                <tr><th colspan="4">{{penaltyInterest.name}} {{penaltyInterest.code}}</th></tr>
                <tr>
                  <th>Description</th>
                  <th>% Of Time Elapse Low is {{penaltyInterest.interestRates.[0].precentageOfTimeElapseLow.operator}} </th>
                  <th>% Of Time Elapse High is {{penaltyInterest.interestRates.[0].precentageOfTimeElapseHigh.operator}}</th>
                  <th>Interest Reduction</th>
                </tr>
                <tr>
                {{#each penaltyInterest.interestRates}}
                  <td>{{description}}</td>
                  <td>{{precentageOfTimeElapseLow.value}}</td>
                  <td>{{precentageOfTimeElapseHigh.value}}</td>
                  <td>{{interestReduction}}</td>
                </tr>
                {{/each}}
              </table>    
            </td>
          </tr>
        </table>
        {{/with}}

    {{/with}}
  </td>
  </tr>
  </table>

  </script>

  <!-- Lending Product Config Partial -->
  <script id="lending-product-config-template" type="text/x-handlebars-template">
    {{#with product.mortgageProductConfiguration.productParameters}}
    <table>
      <tr>
        <td>
        <table>
        <tr><th colspan="2">Product Parameters</th></tr>
        <tr><th>Brand</th><td>{{brand.name}} ({{brand.code}})</td></tr>
        <tr><th>Min Loan Term (Months)</th><td>{{minimumLoanTermInMonths}}</td></tr>
        <tr><th>Max Loan Term (Months)</th><td>{{maximumLoanTermInMonths}}</td></tr>
        <tr><th>Min Loan Amount</th><td>{{minimumLoanAmount}}</td></tr>
        <tr><th>Max Loan Amount</th><td>{{maximumLoanAmount}}</td></tr>
        <tr><th>Security Mandatory</th><td>{{isSecurityMandatory}}</td></tr>
        <tr>
        <th>Security Type</th>
        <td>
        {{#each securityType}}
        <li>{{this.name}} ({{this.code}})</li>
        {{/each}}
        </td>
        </tr>
        <tr>
        <th>Loan Purpose Code</th>
        <td>
        {{#each loanPurposeCode}}
        <li>{{this.name}} ({{this.code}})</li>
        {{/each}}
        </td>
        </tr>
        <tr>
          <th>Payment Frequency</th>
          <td>
            {{#each paymentFrequency}}
            <li>{{this.name}} ({{this.code}}), (default={{this.isDefault}})</li>
            {{/each}}
          </td>
        </tr>
        <tr>
          <th>Payment Method</th>
          <td>
            {{#each paymentmethod}}
            <li>{{this.name}} ({{this.code}}), (default={{this.isDefault}})</li>
            {{/each}}
          </td>
        </tr>
        </td>
        </table>
    {{/with}}
    </td>
    <td>
    {{#with product.mortgageProductConfiguration.financialParameters}}
    {{> financial-parameters-template}}
    {{/with}}
    <br>
    {{#with product.mortgageProductConfiguration.entitlementParameters}}
    {{> entitlements-template}}
    {{/with}}
    <br>
    {{#with product.mortgageProductConfiguration.regulatoryParameters}}
    {{> regulatory-parameters-template}}
    {{/with}}
    </td>
    <td>
    {{#with product.mortgageProductConfiguration.documentations}}
    {{> documentation-template}}
    {{/with}}  
    </td>
  </tr>
  </table>

  </script>

  <!-- Financial Parameters Partial -->
  <script id="financial-parameters-template" type="text/x-handlebars-template">
    <table>
        <tr><th colspan="2">Financial Parameters</th></tr>
        <tr><th>Operating Segment</th><td>{{this.operatingSegment.name}} ({{this.operatingSegment.code}})</td></tr>
        {{#if accountServicingModel }}
        <tr><th>Account Servicing Model</th><td>{{this.accountServicingModel.name}} ({{this.accountServicingModel.code}})</td></tr>
        {{/if}}
        {{#if costCenter}}
        <tr><th>Cost Center</th><td>{{this.costCenter.name}} ({{this.costCenter.code}})</td></tr>
        {{/if}}
        {{#if generalLedger}}
        <tr><th>General Ledger</th><td>{{this.generalLedger.name}} ({{this.generalLedger.code}})</td></tr>
        {{/if}}
        {{#if variableGeneralLedger}}
        <tr><th>Variable General Ledger</th><td>{{this.variableGeneralLedger.name}} ({{this.variableGeneralLedger.code}})</td></tr>
        {{/if}}
        {{#if collections}}
        <tr><th>Unproductive General Ledger</th><td>{{collections.unproductiveGeneralLedger.name}} ({{collections.unproductiveGeneralLedger.code}})</td></tr>
        <tr><th>Collections Customer Credit Rating</th><td>{{collections.collectionsCustomerCreditRating.name}} ({{collections.collectionsCustomerCreditRating.code}})</td></tr>
        {{/if}}
    </table>

  </script>

  <!-- Regulatory Parameters Partial -->
  <script id="regulatory-parameters-template" type="text/x-handlebars-template">
  <table>
    <tr><th colspan="2">Regulatory Parameters</th></tr>

    {{#if riskLevel}}
      <tr><th>Risk Level</th><td>{{riskLevel.name}} ({{riskLevel.code}}) {{riskLevel.description}}</td></tr>
    {{/if}}
    {{#if regulations.regulatoryProductConfiguration.riskLevel}}
      <tr><th>Risk Level</th><td>{{regulations.regulatoryProductConfiguration.riskLevel.name}} ({{regulations.regulatoryProductConfiguration.riskLevel.code}})<br> Description = {{regulations.regulatoryProductConfiguration.riskLevel.description}}</td></tr>
    {{/if}}
    {{#if regulatedIndicator}}
    <tr><th>Regulated Indicator</th>
      <td>
      {{#each regulatedIndicator}}
      <li>{{name}} ({{code}}), (Is Default is {{isDefault}})</li>
      {{/each}}
      </td>
    </tr>
    {{/if}}
    {{#if regulations.regulatoryProductCode}}
      <tr><th>Regulatory Product Code</th><td>{{regulations.regulatoryProductCode}}</td></tr>
      {{/if}}
      {{#if regulations.regulatoryProductName}}
      <tr><th>Regulatory Product Name</th><td>{{regulations.regulatoryProductName}}</td></tr>
      {{/if}}
      {{#if regulations.regulatoryProductDescription}}
      <tr><th>Regulatory Product Description</th><td>{{regulations.regulatoryProductDescription}}</td></tr>
      {{/if}}
      {{#if egulations.regulatoryProductConfiguration.withHoldingTax}}
      <tr><th>Withholding Tax</th><td>{{regulations.regulatoryProductConfiguration.withHoldingTax}}</td></tr>
      {{/if}}
      </td>
      </tr>
  </table>

  {{#if regulations.regulatoryReporting}}
  <table>
    <tr><th colspan="2">Regulatory Reporting</th></tr>
    <tr>
      <th>Regulator</th>
      <th>Reporting</th>
    </tr>
    {{#each regulations.regulatoryReporting}}
    <tr>
      <td>{{name}} ({{code}}) </td>
      <td>
      <table>
        <tr>
        <th>Series</th>
        <th>Classification</th>
        </tr>
        {{#each reportSeries}}
        <tr>
          <td>{{reportSeriesName}} ({{code}})</td>
          <td>{{reportingProductClassificationCode}}</td>
        </tr>
        {{/each}}
      </table>
    {{/each}}
  </table>
  {{/if}}
  </script>

  <!-- Product Fees Partial -->
  <script id="product-fees-template" type="text/x-handlebars-template">
    {{#with product.feePlans}}
    {{#each data}}
    {{#each feePlans}}
    <div class="table_wrapper">
    <table>
      <tr>
      <th>FeePlan</th>
      <th>Fee Items</th>
      </tr>
      <tr>
      <td>
      <table> <!-- Fee Plan -->
        <tr><th>Name</th><td>{{this.feePlanName}} ({{this.code}})</td></tr>
        <tr><th>From Date</th><td>{{formatDate this.feeItemsStartDate}}</td></tr>
        <tr><th>To Date</th><td>{{formatDate this.feeItemsEndDate}}</td></tr>
      </table>
      </td>
      <td>
      <table> <!-- Fee Items -->
        <tr>
        <th>Fee Item</th>
        <th>Type</th>
        <th>Fee Amount Type</th>
        <th>Fee Amount</th>
        </tr>
        {{#each feeItems}}
          <tr>
          <td>{{this.feeItemName}} ({{this.code}})</td>
          <td>{{this.feeItemType}}</td>
          <td>
            {{#if simpleFlatFee}}Simple{{/if}}
            {{#if simpleTransactionalFeeAmount}}Simple{{/if}}
            {{#if tieredTransactionalFee}}Tiered{{/if}}
          </td>
          <td>
          <table> <!-- Fee Amount --> 
          {{#if simpleFlatFee}}
          <tr><th>Amount</th><td>${{simpleFlatFee.amount}}</td></tr>
          {{/if}}
          {{#if simpleTransactionalFeeAmount}}
          <tr><th>Amount Or Percentage</th><td>{{simpleTransactionalFeeAmount.amountOrPercentage}}</td></tr>
          <tr><th>Amount</th><td>${{simpleTransactionalFeeAmount.amount}}</td></tr>
          {{/if}}
          {{#if tieredTransactionalFee}}
          <tr><th>Whole Or Progressive</th><td>{{tieredTransactionalFee.wholeOrProgressive}}</td></tr>
          <tr><th>Volume Or Value</th><td>{{tieredTransactionalFee.volumeOrValue}}</td></tr>
          <tr><th>Amount Or Percentage</th><td>{{tieredTransactionalFee.amountOrPercentage}}</td></tr>
          <tr><th>Tiers End Points Value</th><td>{{tieredTransactionalFee.tiersEndPointsValue}}</td></tr>
          <tr><th>Tiers</th>
          <td>
            <table> <!-- Tiers --> 
            <tr>
            <th>Amount</th>
            <th>From is {{fromOperator}}</th>
            <th>To is {{toOperator}}</th>
            </tr>
            {{#each tieredTransactionalFee.valueTiers}}
            <tr>
            <td>${{amount.value}}</td>
            <td>{{fromValue}}</td>
            <td>{{toValueNumeric}}</td>
            </tr>
            {{/each}}
            </table> <!-- End of Tiers -->
          </td> 
          {{/if}}
          </table> <!-- End of Fee Amount --> 
      {{/each}}
      </table> <!-- End of Fee Items --> 
  </table> <!-- End of Fee Plan --> 
  </div>
  {{/each}}
  {{/each}}
  {{/with}}
  </script>

  <!-- Deposit Product Rate Plan Partial -->
  <script id="deposit-product-rateplan-template" type="text/x-handlebars-template">
    {{#with product.ratePlans}}
    {{#each this.data}}
      {{#with this.ratePlanAssociation}}
      {{#if standardRatePlan.depositStandardRatePlanDetails}}
      {{#with standardRatePlan.depositStandardRatePlanDetails}}
      <h2>Deposit Rates</h2>
      <div class="content">
      <div class="table_wrapper">
      <table>
      <tr>
      <th>Rate Plan</th>
      <th>Rate Grid</th>
      </tr>
      <tr>
      <td>
      <table>
        {{#if name}} <tr><th>Name</th><td>{{name}} ({{code}})</td><tr>{{/if}}
        {{#if ratePlanType}}<tr><th>Rate Plan Type</th><td>{{ratePlanType}}</td><tr>{{/if}}
        {{#if rateType}}<tr><th>Rate Type</th><td>{{rateType}}</td><tr>{{/if}}
        {{#if interestCalculationMethod}}<tr><th>Interest Calculation Method</th><td>{{interestCalculationMethod}}</td><tr>{{/if}}
        {{#if creditBalanceRateTierType}}<tr><th>Credit Balance Rate Tier Type</th><td>{{creditBalanceRateTierType}}</td><tr>{{/if}}
        {{#if debitBalanceRateTierType}}<tr><th> Debit Balance Rate Tier Type</th><td>{{debitBalanceRateTierType}}</td><tr>{{/if}}
        {{/with}}
        </table>
      </td>        
      <td>
      <div class="table_wrapper">
      {{#with this.standardRatePlan.depositStandardRatePlanDetails.rates.rateGrid}}
      {{> rategrid-template}}
      {{/with}}
      </div>
      </td>        
      </tr>
      </table>
      {{/if}}
      {{/with}}
    {{/each}}
    {{/with}}
  </script>

  <!-- Lending Product Rate Plan Partial -->
  <script id="lending-product-rateplan-template" type="text/x-handlebars-template">
    {{#with product.ratePlans}}
    {{#each this.data}}
      {{#with this.ratePlanAssociation}}
      {{#with this.standardRatePlan.mortgageStandardRatePlanDetails}}
        <h2>Mortgage Rate Plan</h2>
        <div class="content">
        <div class="table_wrapper">
        <table>
          <tr>
            <th>RatePlan</th>
            <th>First Term</th>
            <th>Remaining Term</th>
          </tr>
          <td>
            <table>
            <tr><th>Name</th><td>{{name}} ({{code}})</td></tr>
            <tr><th>Rate Plan Type</th><td>{{ratePlanType}}</td></tr>
            <tr><th>First Term Rate Type</th><td>{{twoTermRates.firstPartTermRates.rateType}}</td></tr>
            <tr><th>Remaining Term Rate Type</th><td>{{twoTermRates.remainingPartTermRates.rateType}}</td></tr>
            </table>
          </td>
          <td>
            {{#with this.twoTermRates.firstPartTermRates.rateGrid}}
            {{> rategrid-template}}
            {{/with}}
          </td>
          <td>
            {{#with this.twoTermRates.remainingPartTermRates.rateGrid}}
            {{> rategrid-template}}
            {{/with}}
          </td>
          </tr>
        </table>
        </div>
      {{/with}}
      {{> ratebased-offer-template}}
      {{/with}}
    </div>
    {{/each}}
    {{/with}}
  </script>

  <!-- Rate Base Offer Partial -->
  <script id="ratebased-offer-template" type="text/x-handlebars-template">
    {{#if rateBasedOffers}}
    <h3>Rate Based Offers</h3>
    <div class="content">
    <div class="table_wrapper">
    <table>
      <tr>
        <th>Offer</th>
        {{#if rateBasedOffers.[0].productOfferRatePlanMapping.offerRatePlanDetails.simpleRates}}
        <th>Simple Rate</th>
        {{/if}}
        {{#if rateBasedOffers.[0].productOfferRatePlanMapping.offerRatePlanDetails.twoTermRates}}
        <th>First Term</th>
        <th>Remaining Term</th>
        {{/if}}
      </tr>
      {{#each rateBasedOffers}}
      <tr>
        <td>
        <table>
        <tr><th>Name</th><td>{{name}} ({{code}})</td></tr>
        <tr><th>Publish Externally</th><td>{{publishExternally}}</td></tr>
        <tr><th>Offer Category</th><td>{{offerCategory.name}} ({{offerCategory.code}})</td></tr>
        <tr><th>Status</th><td>{{status}}</td></tr>
        <tr></tr><th>Start Date</th><td>{{formatDate offerStartDate}}</td></tr>
        <tr></tr><th>End Date</th><td>{{formatDate offerEndDate}}</td></tr>
        </table>  
        </td>
        {{#if productOfferRatePlanMapping.offerRatePlanDetails.simpleRates}}
          <td>
          {{#with productOfferRatePlanMapping.offerRatePlanDetails.simpleRates.rates.rateGrid}}
          {{> rategrid-template}}
          {{/with}}
          <br><b>Add logic to check if there are qualifier rules exist</b></td><br>
          </td>
        {{/if}}
        {{#if productOfferRatePlanMapping.offerRatePlanDetails.twoTermRates}}
        <td>
          {{#with productOfferRatePlanMapping.offerRatePlanDetails.twoTermRates.firstPartTermRates.rateGrid}}
          {{> rategrid-template}}
          {{/with}}
          <br><b>Add logic to check if there are qualifier rules exist</b></td><br>
        </td>
        <td>
          {{#with productOfferRatePlanMapping.offerRatePlanDetails.twoTermRates.remainingPartTermRates.rateGrid}}
          {{> rategrid-template}}
          {{/with}}
          </td>
        {{/if}}
      </tr>
    {{/each}}
    </table>
    </div>
    </div>
  {{/if}}
  </script>

  <script id="rategrid-template" type="text/x-handlebars-template">
    <div class="table-responsive table_wrapper" style="overflow-x: auto;">
      <table id="{{uniqueTableId}}" class="table table-sm table-bordered"
        data-toggle="table"
        data-filter-control="true"
        data-search="false"
        data-show-columns="false"
        data-pagination="true"
        data-page-size="25"
        data-page-length="25"
        data-sortable="true"
        data-show-loading="true"
        style="table-layout: fixed; width: 100%;">
        <thead class="thead-dark">
          <tr>
            {{#if row.[0].rate}}
              <th data-field="rate" data-sortable="true" data-filter-control="input" style="width: 100px; max-width: 100px;" title="Rate">Rate</th>
            {{/if}}
            {{#if row.[0].adjustment}}
              <th data-field="adjustment" data-sortable="true" data-filter-control="input" style="width: 100px; max-width: 100px;" title="Adjustment">Adjustment</th>
            {{/if}}
            {{#if row.[0].comparisonRate}}
              <th data-field="comparisonRate" data-sortable="true" data-filter-control="input" style="width: 100px; max-width: 100px;" title="Comparison Rate">Comparison Rate</th>
            {{/if}}
            {{#each row.[0].columns}}
              <th data-field="{{name}}" data-sortable="true" data-filter-control="input" style="width: 100px; max-width: 100px;" title="{{name}} is {{operator}}">{{name}} is {{operator}}</th>
            {{/each}}
          </tr>
        </thead>
        <tbody>
          {{#each row}}
          <tr>
            {{#if rate}} <td style="width: 100px; max-width: 100px;" title="{{rate}}">{{rate}}</td> {{/if}}
            {{#if adjustment}}<td style="width: 100px; max-width: 100px;" title="{{adjustment}}">{{adjustment}}</td>{{/if}}
            {{#if comparisonRate}}<td style="width: 100px; max-width: 100px;" title="{{comparisonRate}}">{{comparisonRate}}</td>{{/if}}
            {{#each columns}}
              <td style="width: 100px; max-width: 100px;" title="{{value}}">{{value}}</td>
            {{/each}}
          </tr>
          {{/each}}
        </tbody>
      </table>
      {{initializeTable}} <!-- Call the helper here -->
    </div>
  </script>
  

  <!-- Services Partial -->
  <script id="services-template" type="text/x-handlebars-template">
    {{#with product.serviceAssociation}}
    {{#if multiUseProducts}}
    <h3>MultiUse Products</h3>
    <div class="content">
    <div class="table_wrapper">
    <table>
    {{#each multiUseProducts }}
    <tr>
    <td>
    <table>
    <tr><th colspan="2">Product</th></tr>  
    <tr><th>Name</th><td>{{productName}} ({{productCode}})</td></tr>
    <tr><th>Classification</th><td>{{productClassification}}</td></tr>
    <tr><th>Status</th><td>{{productLifecycleDetails.productStatus}}</td></tr>
    <tr><th>From Date</th><td>{{formatDate productLifecycleDetails.fromDate}}</td></tr>
    <tr><th>To Date</th><td>{{formatDate productLifecycleDetails.toDate}}</td></tr>
    </table>
    </td>
    <td>
    <table>
      <tr><th colspan="2">Product Paramaters</th></tr>  
      <tr>
      <th>Linked Deposit Products:</th>
      <td>
      {{#each productConfiguration.offsetProductConfiguration.productParameters.linkedDepositProducts}}
      {{name}} ({{code}}) is default = {{isDefault}}<br>
      {{/each}}
      </td>
      </tr>  
      <tr><th>Max Linked Account Count</th><td>{{productConfiguration.offsetProductConfiguration.productParameters.maximumNumberLinkedAccounts}}</td></tr>
      <tr>
      <th>Billing Products</th>
      <td>
      {{#each productConfiguration.offsetProductConfiguration.productParameters.billingProducts}}
      {{name}} ({{code}}) is default = {{isDefault}}<br>
      {{/each}}
      </td>
      </tr>
    </table>
    </td>
    <td>
    <table>
    <tr><th colspan="2">Financial Paramaters</th></tr>  
    <tr><th>Cost Center</th><td>{{productConfiguration.offsetProductConfiguration.financialParameters.costCenter.name}} ({{productConfiguration.offsetProductConfiguration.financialParameters.costCenter.code}})</td></tr>
    <tr><th>General Ledger Code</th><td>{{productConfiguration.offsetProductConfiguration.financialParameters.generalLedger.name}} ({{productConfiguration.offsetProductConfiguration.financialParameters.generalLedger.code}})</td></tr>
    </table>
    </td>
    <td>
    <table>
    <tr><th colspan="2">Fee Plan</th></tr>
    <tr><td>If subscription required, add logic to look up fees..</td></tr>
    </table>
    </td>
    <td>
    <table>
    <tr><th colspan="2">Eligibility</th></tr>
    <tr><td>Add logic to look up eligibility rules..</td></tr>
    </table>
    </td>
    {{/each}}
    </table>
    </div>
    </div>
    {{/if}}

    {{#if services}}
    <h3>Services</h3>
    <div class="content">
    <div class="table_wrapper">
    <table>
        {{#each services}}
        <tr>
        <td>
        <table>
          <tr><th colspan="2">Service</th></tr>  
          <tr><th>Name</th><td>{{name}} ({{code}})</td></tr>
          <tr><th>Category</th><td>{{serviceCategory}}</td></tr>
          <tr><th>Subscription Required</th><td>{{subscriptionRequired}}</td></tr>
        </table>
        </td>
        <td>
        {{#with serviceDetails.[0].serviceEligibilityDetails}}
        {{> eligibility-template}}
        {{/with}}
        </td>
        <td>
        <table>
        <tr><th colspan="2">Service Configuration</th></tr>  
          {{#if serviceDetails.[0].serviceConfiguration.debitCard}}
        <tr><th>Card Category</th><td>{{serviceDetails.[0].serviceConfiguration.debitCard.cardCategory.name}} ({{serviceDetails.[0].serviceConfiguration.debitCard.cardCategory.code}})</td></tr>
        <tr>
        <th>Card Design</th>
        <td>
        {{#each serviceDetails.[0].serviceConfiguration.debitCard.cardDesign }}
        {{name}} ({{code}}) {{#if imageURL}}, imageURL = {{imageURL}}{{/if}}</br>
        {{/each}}
        </td>
        </tr>
        <tr><th>Daily Withdrawal Limit</th><td>{{serviceDetails.[0].serviceConfiguration.debitCard.dailyWithdrawalLimit}}</td></tr>
        {{/if}}
        {{#if serviceDetails.[0].serviceConfiguration.goalService}}
        <tr><th>Service Category</th><td> {{serviceDetails.[0].serviceConfiguration.goalService.serviceCategory}}</td></tr>
        <tr><th>Max Goal Count</th><td> {{serviceDetails.[0].serviceConfiguration.goalService.maxNumberofGoals}}</td></tr>
        <tr> 
        <th>Goal Mapping</th>
        <td>
        {{#each serviceDetails.[0].serviceConfiguration.goalService.goalMapping}}
        {{name}} ({{code}}), Type= {{type}}, isBaseGaol={{isBaseGoal}}<br>
        {{/each}}
        </td>
        </tr>
        {{/if}}
        {{#if serviceDetails.[0].serviceConfiguration.creditCard}}
        <tr><th>Card Category</th><td>{{serviceDetails.[0].serviceConfiguration.creditCard.cardCategory.name}} ({{serviceDetails.[0].serviceConfiguration.creditCard.cardCategory.code}})</td></tr>
        <tr>
        <th>Card Design</th>
        <td>
        {{#each serviceDetails.[0].serviceConfiguration.creditCard.cardDesign }}
        {{name}} ({{code}}) {{#if imageURL}}<br><br> imageURL = {{imageURL}}{{/if}}<br><br>
        {{/each}}
        </td>
        </tr>
        <tr><th>Daily Withdrawal Limit</th><td>{{serviceDetails.[0].serviceConfiguration.creditCard.dailyWithdrawalLimit}}</td></tr>
        <tr><th>Monthly Withdrawal Limit</th><td>{{serviceDetails.[0].serviceConfiguration.creditCard.monthlyWithdrawalLimit}}</td></tr>
        </tr>
        {{/if}}
        </table>
        </td>
        </tr>
        {{/each}}
    </table>
    </div>
    </div>
  {{/if}}
  {{/with}}
  </script>

  <!-- Entitlements Partial -->
  <script id="entitlements-template" type="text/x-handlebars-template">
    <table>
        <tr><th colspan="2">Entitlements</th></tr>
        <tr><th>Enabled For Open Banking</th><td>{{this.enabledForOpenBanking}}</td></tr>
        {{#if transactOptions}}
        <th>Transact Options</th>
        <td>
          {{#each transactOptions}}
          <li>{{this.code}}</li>
          {{/each}}
        </td>
        </tr>
        {{/if}}
    </table>
  </script>

  <!-- Documention Partial -->
  <script id="documentation-template" type="text/x-handlebars-template">
    <table>
      <tr><th colspan="4">Documentation</th></tr>
        <tr>
          <th>Type</th>
          <th>Document</th>
          <th>Reference ID</th>
          <th>External URL</th>
        </tr>
        {{#each termsAndConditions}}
        <tr>
        <td>Terms And Conditions</td>
        <td>{{this.name}} ({{this.code}})</td>
        <td>{{this.documentReferenceID}}</td>
        <td>{{this.externalURL}}</td>
        </tr>
        {{/each}}
        {{#each termsAndConditions}}
        <tr>
        <td>Marketing Collateral</td>
        <td>{{this.name}} ({{this.code}})</td>
        <td>{{this.documentReferenceID}}</td>
        <td>{{this.externalURL}}</td>
        </tr>
        {{/each}}
    </table>
  </script>

  <!-- External Product Code Mapping Partial -->
  <script id="external-product-code-mapping-template" type="text/x-handlebars-template">
    <table>
      <tr>
        <th>Product</th>
        <th>System Of Record</th>
      </tr>
      <tr>
      {{#each product.externalProductCodeMapping}}
        <td>{{this.name}} ({{this.code}})</td>
        <td>{{systemOfRecord.name}} ({{this.systemOfRecord.code}})</td>
      </tr>
      </table>
      {{/each}}
  </script>

  <!-- Impacted Systems Partial -->
  <script id="impacted-systems-template" type="text/x-handlebars-template">
      <table>
        <tr>
          <th>System</th>
          <th>Product</th>
          <th>Product Classification</th>
        </tr>
        <tr>
        {{#each product.impactedSystems}}
          <td>{{this.name}} ({{this.code}})</td>
          <td>{{impactedSystemProductName}} ({{impactedSystemProductCode}})</td>
          <td>{{impactedSystemProductClassification}}</td>
        </tr>
        </table>
        {{/each}}
  </script>

  <script>

    // Register partials
    Handlebars.registerPartial('product-name-template', document.getElementById('product-name-template').innerHTML);
    Handlebars.registerPartial('eligibility-template', document.getElementById('eligibility-template').innerHTML);
    Handlebars.registerPartial('deposit-product-config-template', document.getElementById('deposit-product-config-template').innerHTML);
    Handlebars.registerPartial('term-deposit-product-config-template', document.getElementById('term-deposit-product-config-template').innerHTML);
    Handlebars.registerPartial('lending-product-config-template', document.getElementById('lending-product-config-template').innerHTML);
    Handlebars.registerPartial('financial-parameters-template', document.getElementById('financial-parameters-template').innerHTML);
    Handlebars.registerPartial('regulatory-parameters-template', document.getElementById('regulatory-parameters-template').innerHTML);
    Handlebars.registerPartial('product-fees-template', document.getElementById('product-fees-template').innerHTML);
    Handlebars.registerPartial('deposit-product-rateplan-template', document.getElementById('deposit-product-rateplan-template').innerHTML);
    Handlebars.registerPartial('lending-product-rateplan-template', document.getElementById('lending-product-rateplan-template').innerHTML);
    Handlebars.registerPartial('ratebased-offer-template', document.getElementById('ratebased-offer-template').innerHTML);
    Handlebars.registerPartial('services-template', document.getElementById('services-template').innerHTML);
    Handlebars.registerPartial('rategrid-template', document.getElementById('rategrid-template').innerHTML);
    Handlebars.registerPartial('entitlements-template', document.getElementById('entitlements-template').innerHTML);
    Handlebars.registerPartial('documentation-template', document.getElementById('documentation-template').innerHTML);
    Handlebars.registerPartial('open-banking-template', 'hbs/open-banking.hbs');
    Handlebars.registerPartial('external-product-code-mapping-template', document.getElementById('external-product-code-mapping-template').innerHTML);
    Handlebars.registerPartial('impacted-systems-template', document.getElementById('impacted-systems-template').innerHTML);

    let logConsole;
    // let selectedLeftProduct = null;
    // let selectedRightProduct = null;

    const BANKS = {
      prod: { name: 'PROD', json: 'datasets/prod.json'},
      preprod: { name: 'Pre-Prod', json: 'datasets/preprod.json'},
      sitk: { name: 'SIT-K', json: 'datasets/sitk.json'},
      sitl: { name: 'SIT-L', json: 'datasets/sitl.json'},
      st: { name: 'ST', json: 'datasets/st2.json'},
    }
    let savedBankId

    const PRODUCTS = {
      DEPOSIT: {
        name: 'Deposits',
      },
      TIME_DEPOSIT: {
        name: 'Time Deposits',
      },
        CRED_AND_CHRG_CARDS: {
        name: 'Credit and Charge Cards',
      },
        MORTGAGE: {
        name: 'Residential Mortgages',
      },
      OFFERS: {
        name: 'Marketing Propositions',
      },
    }

    function logToConsole(msg) {
      console.log(msg)
      // logConsole.value += msg + '\n'
    }


    async function getProducts(bank) {
      let jsonUrl = `${bank.json}`; // Path to the JSON file
      try {
        logToConsole(`Getting products for ${bank.name}`);
        const start = new Date();
        let response = await fetch(jsonUrl);
        let jsonData = await response.json();
        const duration = (new Date() - start) / 1000;

        // Assuming you're interested in the first entry in the data array
        const res = jsonData.data && jsonData.data[0] ? {
          asofDate: jsonData.requestDate,
          count: jsonData.data[0].productDetails.length,
          products: jsonData.data[0].productDetails
        } : { asofDate: null, count: 0, products: [] };

        logToConsole(`Got products for ${bank.name} in ${duration}s`);
        console.log(res);
        return res;
      } catch (err) {
        logToConsole(`Error getting data for ${bank.name} from ${bank.json}`);
        console.error(err);
        return { products: [], count: 0 };
      }
    }

    function processProducts(products) {
      const byCategory = {};

      // Initialize categories in byCategory object
      for (let prodCat in PRODUCTS) {
        byCategory[prodCat] = { count: 0, products: [] };
      }

      products.forEach((p) => {
        const category = p.productClassification; // or the key you're using

        // Ensure the category exists in the PRODUCTS object
        if (category && PRODUCTS[category]) {
          byCategory[category].count++;
          byCategory[category].products.push(p);
        } else {
          console.warn(`Product ${p.productName} has an unknown or missing category: ${category}`);
        }
      });

      return byCategory;
    }

    async function toggleDiagram(productId) {
        const bankId = savedBankId;
        const diagramButton = document.getElementById('diagram-btn');

        if (diagramButton.textContent === 'Show Diagram') {
          const h2 = document.createElement('h2');
          // h2.style.color = 'blue';
          h2.textContent = 'Diagram is a placeholder and does not reflect actual product details';
          document.getElementById("product-details-diagram-content").appendChild(h2);
          const iframe = document.createElement('iframe');
          iframe.width = "80%";
          iframe.height = "500";
          iframe.frameBorder = "0";
          iframe.src = "https://gobravedave.github.io/sandbox/gojs-product.html";
          document.getElementById("product-details-diagram-content").appendChild(iframe);
          diagramButton.textContent = 'Hide Diagram';
        } else {
            document.getElementById("product-details-diagram-content").innerHTML = "";
            diagramButton.textContent = 'Show Diagram';
        }
    }

    async function toggleJson(productId) {
      logToConsole(`Showing JSON for bank ${savedBankId} productId ${productId}`)
      const jsonBtn = document.getElementById('json-btn');
      if (jsonBtn.textContent === 'Show JSON') {
        let productDetails = BANKS[savedBankId].productsRaw.find(prod => prod.productCode=== productId);

        var pre = document.getElementById("product-details-json-content");
        pre.innerHTML = ""; // Clear previous JSON content
        renderjson.set_icons('+', '-');
        renderjson.set_show_to_level(2);
        // renderjson.set_collapse_msg(function(len) { return len + " item" + (len==1 ? "" : "s") })
        pre.appendChild(renderjson(productDetails));
        jsonBtn.textContent = 'Hide JSON';
      } else {
        document.getElementById("product-details-json-content").innerHTML = "";
        jsonBtn.textContent = 'Show JSON';
      }
    }

    async function toggleCheck(productId) {
      logToConsole(`Showing Checker for bank ${savedBankId} productId ${productId}`)
      const checkBtn = document.getElementById('check-btn');
      if (checkBtn.textContent === 'Show Checker') {
        let productDetails = BANKS[savedBankId].productsRaw.find(prod => prod.productCode=== productId);

        var pre = document.getElementById("product-details-checker-content");
        pre.innerHTML = ""; // Clear previous Checker content
        const h2 = document.createElement('h2');
        // h2.style.color = 'blue';
        h2.textContent = 'Coming soon...';
        document.getElementById("product-details-checker-content").appendChild(h2);
        
        checkBtn.textContent = 'Hide Checker';
      } else {
        document.getElementById("product-details-checker-content").innerHTML = "";
        checkBtn.textContent = 'Show Checker';
      }
    }

    async function toggleCompare(productId) {
      logToConsole(`Showing Compare for bank ${savedBankId} productId ${productId}`)
      const compareBtn = document.getElementById('compare-btn');
      if (compareBtn.textContent === 'Show Compare') {
        let productDetails = BANKS[savedBankId].productsRaw.find(prod => prod.productCode=== productId);

        var pre = document.getElementById("product-details-compare-content");
        const compareWithSelect = document.getElementById("compare-with");
        compareWithSelect.style.display = "block";
        populateCompareDropdown();
        pre.innerHTML = ""; // Clear previous Compare content
        const h2 = document.createElement('h2');
        // h2.style.color = 'blue';
        h2.textContent = 'Also coming soon...';
        document.getElementById("product-details-compare-content").appendChild(h2);
        compareBtn.textContent = 'Hide Compare';
      } else {
        document.getElementById("product-details-compare-content").innerHTML = "";
        document.getElementById("compare-with").style.display = "none";
        compareBtn.textContent = 'Show Compare';
      }
    }

    function populateCompareDropdown() {
      const $compareDropdown = document.getElementById('compare-with');
      if ($compareDropdown) {
        // Clear previous options first to avoid duplication
        $compareDropdown.innerHTML = '<option value="">Compare with</option>';

        for (const key in BANKS) {
          if (BANKS.hasOwnProperty(key)) {
            const option = document.createElement('option');
            option.value = key; // Use the key as the value
            option.textContent = BANKS[key].name; // Use the name property as the display text
            $compareDropdown.appendChild(option);
          }
        }
      }
    }


    window.onload = async function () {

    Handlebars.logger.level = 0; // for DEBUG
    // Register helpers
    Handlebars.registerHelper('formatDate', function(dateString) {
    const date = new Date(dateString);
    return date.toLocaleDateString('en-AU');
    });

    let tableIndex = 0; // Global counter for table IDs
    Handlebars.registerHelper('uniqueTableId', function() {
      return `table-${tableIndex++}`;
    });

    // Register a Handlebars helper to execute JavaScript code after rendering
    Handlebars.registerHelper('initializeTable', function() {
    // After the DOM is updated, initialize each table separately
      setTimeout(() => {
        $('[id^=table-]').each(function() {
          const tableId = $(this).attr('id');
          $('#' + tableId).bootstrapTable(); // Initialize the Bootstrap Table
        });
      }, 100);
    });

      let productListTpl = Handlebars.compile(document.getElementById('products-list-template').innerHTML)
      const $productsList = document.getElementById('products-list')

      $productsList.innerHTML = productListTpl({})
      let productDetailsTpl = Handlebars.compile(document.getElementById('product-details-template').innerHTML)

      // logConsole = document.getElementById('log-console')

      await Promise.all(Object.entries(BANKS).map(async ([id, bank]) => {
        BANKS[id].id = id
        for (let prodCat in PRODUCTS) {
          PRODUCTS[prodCat].banks = PRODUCTS[prodCat].banks || {}
          PRODUCTS[prodCat].banks[id] = {
            bankId: id,
          }
        }

        const { asofDate, count, products } = await getProducts(bank)
        BANKS[bank.id].productsRaw = products
        BANKS[bank.id].totalCount = count
        BANKS[bank.id].asofDate = asofDate

        // add banks product count and list to PRODUCTS
        const byCategory = processProducts(products)
        for (let prodCat in PRODUCTS) {
          PRODUCTS[prodCat].banks[bank.id].count = byCategory[prodCat].count
          PRODUCTS[prodCat].banks[bank.id].products = byCategory[prodCat].products
        }

        $productsList.innerHTML = productListTpl({ BANKS, PRODUCTS })
      }))
      logToConsole('Processed products from all banks')
      console.log({ BANKS, PRODUCTS })

      $productsList.innerHTML = productListTpl({ BANKS, PRODUCTS })

      let $catRows = document.querySelectorAll('.category-row')
      for (let $catRow of $catRows) {
        // clicking on category row will show all products of that category
        $catRow.addEventListener('click', function (e) {
          let { catId } = e.target.parentNode.dataset
          let $catProdsEl = document.querySelector(`#products-${catId}`)
          $catRow.classList.toggle('expanded')
          $catProdsEl.classList.toggle('hidden')
        })
      }

      let $prodNames = document.querySelectorAll('.product-name')
      for (let $prodName of $prodNames) {
        // clicking on product name will show product details
        $prodName.addEventListener('click', async function (e) {
          let { bankId, productCode } = e.target.dataset
          savedBankId = bankId
          document.getElementById('product-details').innerHTML = '<div id="product-details-content">Fetching product details...<span id="product-details-close">&times;</span></div>'
          document.getElementById('product-details').style.display = 'block'
          document.getElementById('product-details-close').addEventListener('click', function (e) {
            document.getElementById('product-details').style.display = 'none'
            document.getElementById('product-details').innerHTML = ''
          })

          let productDetails = BANKS[bankId].productsRaw.find(prod => prod.productCode === productCode);
          console.log({productDetails})

          // Compile the main product template

          if (productDetails) {
            document.getElementById('product-details').innerHTML = productDetailsTpl({ product: productDetails, asofDate: BANKS[bankId].asofDate, place: BANKS[bankId].name });
          } else {
            document.getElementById('product-details').innerHTML = `<div id="product-details-content">Product details not found.<span id="product-details-close">&times;</span></div>`;
          }

          document.getElementById('product-details-close').addEventListener('click', function (e) {
            document.getElementById('product-details').style.display = 'none'
            document.getElementById('product-details').innerHTML = ''
          })
        })
      }

    }

  // Add event listener to all headings
  document.addEventListener('click', function(event) {
    if (event.target.tagName.match(/H[1-4]/i)) {
      // Toggle visibility of the next element (content)
      const nextContent = event.target.nextElementSibling;
      if (nextContent && nextContent.classList.contains('content')) {
        nextContent.style.display = nextContent.style.display === 'none' ? 'block' : 'none';
      }
    }
  });

    </script>

    <h1>Zafin Product Configuration Viewer</h1>
    <div style="border-radius: 10px; border: 1px solid #212e01; padding: 10px; background-color: #acc8f1;margin-left: 5px;margin-right: 5px;">
    <h4>About this page</h4>
    <div class="content">
    <ul style="list-style: square; padding-left: 10px;">
      <li>This page is a static view of the product configurations from each Zafin environment. The data will be periodically updated as part of a product configuration relaese or upon request to <a href="mailto:david.anderson@anz.com">david.anderson@anz.com</a></li>
      <li>To use.. Click on a product category to show products in each environment. Click on a product button to show the product details.</li>
      <li>Known data gaps include multiuse product fees, rulesets, offers, credit card config etc</li>
      <li>Backlog items include calling mulesoft to pull product data, compare, config checker, diagram view</li>
    </ul>
    </div>
    </div>
    <br>

    <!-- <textarea id="log-console" style="height: 100px; width: 500px;"></textarea> -->
    <div id="products-list"></div>
    <div id="product-details"></div>

<!-- Main Product Template -->
<script id="product-details-template" type="text/x-handlebars-template">
  <div id="product-details-content">
    <button id="diagram-btn" onclick="toggleDiagram( '{{product.productCode}}')" >Show Diagram</button>
    <button id="json-btn" onclick="toggleJson( '{{product.productCode}}')">Show JSON</button>
    <button id="check-btn" onclick="toggleCheck( '{{product.productCode}}')">Show Checker</button>
    <button id="compare-btn" onclick="toggleCompare( '{{product.productCode}}')">Show Compare</button>
    <span id="product-details-close">&times;</span>
    <div><pre id="product-details-diagram-content"></pre></div>
    <div><pre id="product-details-json-content"></pre></div>
    <div><pre id="product-details-checker-content"></pre></div>
    <div><pre id="product-details-compare-content"></pre>
      <select id="compare-with" style="width: 200px; display: none">
        <option value="">Compare with Bank</option>
      </select>
  
    </div>

  {{> product-name-template}}

  <h2>Eligibility</h2>
  <div class="content">
  {{#with product.productEligibilityDetails}}
  {{> eligibility-template}}
  {{/with}}
  </div>

  {{#if product.productConfiguration}}
    <h2>Deposit Product Configuration</h2>
    <div class="content">
    <div class="table_wrapper">
        {{> deposit-product-config-template}}
    </div>
    </div>
  {{/if}}

  {{#if product.termDepositProductConfiguration}}
  <h2>Term Deposit Product Configuration</h2>
  <div class="content">
  <div class="table_wrapper">
      {{> term-deposit-product-config-template}}
  </div>
  </div>  
  {{/if}}

  {{#if product.mortgageProductConfiguration}}
    <h2>Lending Product Configuration</h2>
    <div class="content">
    <div class="table_wrapper">
    {{> lending-product-config-template}}
    </div>
    </div>
  {{/if}}

  {{#if product.feePlans}}
    <h2>Fee Plans</h2>
    <div class="content">
    <div class="table_wrapper">
    {{> product-fees-template}}
    </div>
    </div>
  {{/if}}

  {{> deposit-product-rateplan-template}}
  {{> lending-product-rateplan-template}}

  {{#if product.serviceAssociation}}
  <h2>Associated Services</h2>
  <div class="content">
  <div class="table_wrapper">    
  {{> services-template}}
  </div>
  </div>  
  {{/if}}

  {{#if product.openBankingConfiguration}}
  <h2>Open Banking</h2>
  <div class="content">
  <div class="table_wrapper">
      {{> hbs/open-banking.hbs}}
  </div>
  </div>
  {{/if}}

  {{#if product.externalProductCodeMapping}}
  <h2>External Product Code Mapping</h2>
  <div class="content">
  <div class="table_wrapper">
  {{> external-product-code-mapping-template}}
  </div>
  </div> 
  {{/if}}

  {{#if product.impactedSystems}}
    <h2>Impacted Systems</h2>
    <div class="content">
    <div class="table_wrapper">
    {{> impacted-systems-template}}
    </div>
    </div>
  {{/if}}
</div>
</script>


  <script id="products-list-template" type="text/x-handlebars-template">
    <table style="width: 100%">
      <tr>
        <th>Environment</th>
        {{#each BANKS}}
          <th>{{this.name}}</th>
        {{/each}}
      </tr>
      <tr>
        <td>Total Products</td>
        {{#each BANKS}}
          <td>{{this.totalCount}}</td>
        {{/each}}
      </tr>
      {{#each PRODUCTS}}
        <tr class="category-row" data-cat-id="{{@key}}">
          <td class="category-title">{{this.name}}</td>
          {{#each this.banks}}
            <td>{{this.count}}</td>
          {{/each}}
        </tr>
        <tr class="category-products-list hidden" id="products-{{@key}}">
          <td></td>
          {{#each this.banks}}
            <td class="category-products-main">
              <table>
                {{#each this.products}}
                  <tr>
                    <td>
                      <button class="product-name" data-bank-id="{{../bankId}}" data-product-code="{{this.productCode}}" title="{{this.productDescription}}">{{this.productName}}</button>
                    </td>
                  </tr>
                {{/each}}
              </table>
            </td>
          {{/each}}
        </tr>
      {{/each}}
  </table>
  </script>

  <style>
    body {
      font-family: Arial;
    }

    h1, h2, h3, h4 {
      padding-top: 12px;
      cursor: pointer;
      color: #371282;
    }
    .content {
        display: block;
        margin-left: 20px;
    }

   .table_wrapper{
    display: block;
    overflow-x: auto;
    white-space: nowrap;
    }

    .flex-container {
      display: flex;
      flex-wrap: wrap;
    }

  .flex-container > div {
    width: 200px;
    margin: 10px;
    padding: 10px;
  }

/* Optional tooltip styling */
.table th[title]:hover, 
.table td[title]:hover {
  position: relative;
  cursor: pointer; /* Optional: add cursor pointer on hover */
}

.table th[title]:hover:after, 
.table td[title]:hover:after {
  content: attr(title);
  position: absolute;
  background-color: #333;
  color: #fff;
  padding: 5px 10px;
  border-radius: 5px;
  white-space: nowrap;
  top: -30px; /* Position above the element */
  left: 50%; /* Center tooltip */
  transform: translateX(-50%);
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s ease;
  z-index: 1;
}

.table th[title]:hover:after, 
.table td[title]:hover:after {
  opacity: 1;
}

    .table th, .table td {
      word-wrap: break-word;
      white-space: normal !important; /* Allow text to wrap */;
      width: 100px; /* Set this based on your requirement */
      max-width: 100px;
      overflow: hidden;
      text-overflow: ellipsis; /* Add ellipsis for overflow text */
    }

    table {
      border-collapse: collapse;
    }

    th {
      background: #eee;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      /* text-align: center; */
      vertical-align: top;
      font-size: 14px;
    }

    select {
    font-family: Arial, sans-serif;
    font-size: 14px;
    padding: 10px 15px;
    margin: 5px 0;
    border-radius: 5px;
    border: 1px solid #ccc;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    background-color: #f7f7f7;
    cursor: pointer;
    transition: background-color 0.3s ease, box-shadow 0.3s ease;
  }

select:focus {
  outline: none;
  border-color: #007bff;
  box-shadow: 0 0 6px rgba(0, 123, 255, 0.5);
}

select:hover {
  background-color: #eaeaea;
}

select:disabled {
  background-color: #e0e0e0;
  cursor: not-allowed;
}

select {
  width: auto;
  min-width: 200px;
  max-width: 100%;
}

    button {
      background-color: white;
      color: #3949ab;
      border: 1px solid #3949ab;
      border-radius: 8px;
      padding: 10px 20px;
      transition-duration: 0.4s;
    }

    button[disabled]:hover {
      background: red;
    }

    button:hover {
    background-color: #3949ab; /* purple */
    color: white;
  }
    .category-row.expanded {
      background-color: #eee;
    }
    .category-row:hover {
      background-color: #eee;
    }
    .category-title {
      cursor: pointer;
      width: 200px;
    }

    .product-name {
      cursor: pointer;
    }


    .category-products-main {
      padding: 0;
    }
    .category-products-main table {
      width: 100%;
    }
    .category-products-main table td {
      border: 0;
    }
    .category-products-list.hidden {
      display: none;
    }


    #product-details {
      display: none; /* Hidden by default */
      position: fixed; /* Stay in place */
      z-index: 1; /* Sit on top */
      left: 0;
      top: 0;
      width: 100%; /* Full width */
      height: 100%; /* Full height */
      overflow: auto; /* Enable scroll if needed */
      background-color: rgb(0,0,0); /* Fallback color */
      background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
    }

    #product-details-content {
      background-color: #fefefe;
      margin: 50px auto; /* 15% from the top and centered */
      padding: 20px;
      border: 1px solid #888;
      width: 80%; /* Could be more or less, depending on screen size */
    }
    #product-details-close {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
    }
    #product-details-close:hover,
    #product-details-close:focus {
      color: black;
      text-decoration: none;
      cursor: pointer;
    }

    .thead-dark th {
      background: #eee;
    }

  </style>

  </body>
  </html>
